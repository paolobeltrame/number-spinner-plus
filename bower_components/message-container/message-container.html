<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<dom-module id="message-container">
  <template>
      <style>
        :host {
          display: block;
        }

        .messageError{
          color:var(--message-container-error-text-color,darkred); 
          background-color: var(--message-container-error-background-color,rgba(245, 0, 0, 0.60));
          
          margin-top: 2%;
          margin-bottom: 2%;

          font-size:var(--message-container-error-text-size,12px);

          padding-top:2%;
          padding-bottom:2%;
          padding-left: 2%;
          padding-right: 2%;

          border-left:var(--message-container-error-border-left,6px solid darkred);

          box-shadow:var(--message-container-error-box-shadow, 0 2px 4px 0 rgba(245, 0, 0, 0.25), 0 4px 10px 0 rgba(245, 0, 0, 0.2));
        }

        .messageOk{
          color:var(--message-container-ok-text-color,darkgreen); 
          background-color:var(--message-container-ok-background-color,rgba(0, 245, 0, 0.60));
          
          margin-top: 2%;
          margin-bottom: 2%;

          font-size:var(--message-container-ok-text-size,12px);

          padding-top:2%;
          padding-bottom:2%;
          padding-left: 2%;
          padding-right: 2%;

          border-left:var(--message-container-ok-border-left,6px solid darkgreen);

          box-shadow:var(--message-container-ok-box-shadow,0 2px 4px 0 rgba(0, 245, 0, 0.25), 0 4px 10px 0 rgba(0, 245, 0, 0.2));
        }     

        .messageWarning{
          color: var(--message-container-warning-text-color,rgb(139,139,0));
          background-color: var(--message-container-warning-background-color,rgba(245, 245, 0, 0.60));
          margin-top: 2%;
          margin-bottom: 2%;

          font-size: var(--message-container-warning-text-size,12px);

          padding-top:2%;
          padding-bottom:2%;
          padding-left: 2%;
          padding-right: 2%;

          border-left: var(--message-container-warning-border-left,6px solid rgb(139,139,0));

          box-shadow: var (--message-container-warning-box-shadow,0 2px 4px 0 rgba(245, 245, 0, 0.25), 0 4px 10px 0 rgba(245, 245, 0, 0.2));
        }
      </style>

      <div class$="[[generateClass(errorTernaryFlag)]]">
        <i class$="[[generateMessageIcon(errorTernaryFlag)]]"></i> [[generateMessage(errorTernaryFlag)]]
      </div>
      
  </template>
  
  <script>
        Polymer({
            // FUNTCION RESET FLAGS
            resetFlags:function() {
                this.errorFlag=false;
                this.warningFlag=false;  
            },

            // FUNTCION controlValue
            controlValue:function (Value) {  
                
                // 1.RESET FLAGS       
                this.resetFlags();
 
                // 2.ERROR ENGINE
                if(this.allowedCharset!=null&&!this.errorFlag) {
                    var allowed=          new RegExp (this.allowedCharset);               
                    this.errorFlag=       (!allowed.test  (Value));
                };

                if(this.deniedCharset!=null&&!this.errorFlag) {
                    var denied =          new RegExp (this.deniedCharset);
                    this.errorFlag=       (denied.test    (Value));
                };

                // 3.NUMBER LIMIT ERRORS
                if((this.minNumberAllowed!=null||this.maxNumberAllowed!=null)&&!this.errorFlag) {
                    this.errorFlag=((Value<this.minNumberAllowed)||(Value>this.maxNumberAllowed));
                };

                // 4.WARNING ENGINE
                if(!this.errorFlag)   
                {         
                  if(this.recommendedCharset!=null&&!this.warningFlag) {
                      var recommended =     new RegExp (this.recommendedCharset);
                      this.warningFlag =    !recommended.test   (Value);
                  };

                  if(this.notRecommendedCharset!=null&&!this.warningFlag) {
                      var notRecommended =  new RegExp (this.notRecommendedCharset);
                      this.warningFlag =    notRecommended.test (Value);
                  };

                  // 5.NUMBER LIMIT WARNINGS
                  if((this.minNumberWarned!=null||this.maxNumberWarned!=null)&&!this.warningFlag) {
                      this.warningFlag=((this.content<=this.minNumberWarned)||(this.content>=this.maxNumberWarned));
                  }; 
                };
            },

            // FUNTCION _valueChanged: observer for content property            
            _valueChanged:function(newValue){
                
                // 1. CONTROL THE VALUE
                this.controlValue(newValue);          
                                
                // 2. CHOOSE THE CORRECT FLAG: [-1] Error, [0] Ok, [1] Warning, [null] Not processed
                if (this.errorFlag) {
                  return -1;
                }
                else if (this.warningFlag) {
                  return 1;
                }
                else {
                  if (this.enableOkMessage) {
                    return 0;
                    }
                    else {
                      return null;
                    };
                };
            },

            // FUNTCION generateClass: Generate the correct class ([-1] Error, [0] Ok, [1] Warning, [null] Not processed)
            generateClass:function (errorTernaryFlag) {
                
                // 1. CHOOSE THE CORRECT CLASS
                if (errorTernaryFlag==-1) {
                  return "messageError";
                }
                else if (errorTernaryFlag==1) {
                  return "messageWarning";
                }
                else {
                  if (this.enableOkMessage) {
                    return "messageOk";
                    }
                    else {
                      return null;
                    };
                };
            },    

            // FUNTCION generateMessage: Generate the correct message ([-1] Error, [0] Ok, [1] Warning, [null] Not processed)
            generateMessage:function (errorTernaryFlag) {  
               
                // 1. CHOOSE THE CORRECT MESSAGE
                if (errorTernaryFlag==-1) {
                  return this.errorMessage;
                }
                else if (errorTernaryFlag==1) {
                  return this.warningMessage;
                }
                else {
                  if (this.enableOkMessage) {
                    return this.okMessage;
                  }
                  else {
                    return null;
                  };
                };
            }, 

            // FUNTCION generateClass: Generate the correct icon ([-1] Error, [0] Ok, [1] Warning, [null] Not processed). Future feature: CSS implementation (icon customizable)
            generateMessageIcon:function (errorTernaryFlag) {
                
                // 1. CHOOSE THE CORRECT CLASS
                if (errorTernaryFlag==-1) {
                  return "fa fa-exclamation";
                }
                else if (errorTernaryFlag==1) {
                  return "fa fa-exclamation";
                }
                else {
                  if (this.enableOkMessage) {
                    return "fa fa-check";
                    }
                    else {
                      return null;
                    };
                };
            },       
                       
            is: 'message-container',
        
            properties:{

            content:{

            },
        

            // Error proprerties definitions
            allowedCharset:{
              type:String,
              value:null,             
            },
            
            deniedCharset:{
              type:String,
              value:null,             
            },

            errorFlag:{
              type:Boolean,
              value:false,
            },

            enableOkMessage:{
              type:Boolean,
              value:true,
            },
            
            okMessage:{
              type:String,
              value:"Content allowed",
            },    
          
            errorMessage:{
              type:String,
              value:"Content denied",
            },
        
            // NUMBER LIMIT: To handle limits with numbers
            minNumberAllowed:{
              type:Number,
              value:null,
            },

            maxNumberAllowed:{
              type:Number,
              value:null,
            },
  
            // WARNINGS PROPRETIES: To handle warning message
            warningFlag:{
              type:Boolean,
              value:false,
            },    

            recommendedCharset:{
              type:String,
              value:null,
            },

            notRecommendedCharset:{
              type:String,
              value:null,
            },
            
            warningMessage:{
              type:String,
              value:"Be careful",
            },

            // WARNING NUMBER LIMIT: To handle limits with numbers (only warning, not error)           
            minNumberWarned:{
              type:Number,
              value:25,
            },
            
            maxNumberWarned:{
              type:Number,
              value:75,
            },

            errorTernaryFlag:{
              type:Number,
              value:null,
              computed:"_valueChanged(content)",
            },            
          },
        }); 
    </script>
</dom-module>

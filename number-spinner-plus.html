<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/number-spinner-validator-plus/number-spinner-validator-plus.html">
<link rel="import" href="../bower_components/message-container/message-container.html">

<!--
`number-spinner-plus`


@demo demo/index.html
-->

<dom-module id="number-spinner-plus">
  <template>
<!--

  STYLE PROPRETIES

-->
    <style>
        :host {
            display: block;
            --number-spinner-color:red;
            /* FOR MODIFY MESSAGE CONTAINER PROPRETIES
            --number-spinner-message-text-size:size;

            --number-spinner-error-text-color:color;
            --number-spinner-error-background-color:color;
            --number-spinner-error-border-left:size type color;
            --number-spinner-error-box-shadow: see: http://www.w3schools.com/cssref/css3_pr_box-shadow.asp

            --number-spinner-ok-text-color:color;
            --number-spinner-ok-background-color:color;
            --number-spinner-ok-border-left:size type color;
            --number-spinner-ok-box-shadow: see: http://www.w3schools.com/cssref/css3_pr_box-shadow.asp

            --number-spinner-warning-text-color:color;
            --number-spinner-warning-background-color:color;
            --number-spinner-warning-border-left:size type color;
            --number-spinner-warning-box-shadow: http://www.w3schools.com/cssref/css3_pr_box-shadow.asp
            */

            /*UNSELECT BUTTON*/
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none; 
            
            width:fit-content;
        }

        message-container {
            --message-container-text-size:var(--number-spinner-message-text-size);
            
            /*ERROR MESSAGE PROPERTIES*/
            --message-container-error-text-color:var(--number-spinner-error-text-color);
            --message-container-error-background-color:var(--number-spinner-error-background-color);
            --message-container-error-border-left:var(--number-spinner-error-border-left);
            --message-container-error-box-shadow:var(--number-spinner-error-box-shadow);              

            /*OK MESSAGE PROPERTIES*/
            --message-container-ok-text-color:var(--number-spinner-ok-text-color);
            --message-container-ok-background-color:var(--number-spinner-ok-background-color);
            --message-container-ok-border-left:var(--number-spinner-ok-border-left);
            --message-container-ok-box-shadow:var(--number-spinner-ok-box-shadow);             
           
            /* WARNING MESSAGE PROPERTIES*/
            --message-container-warning-text-color:var(--number-spinner-warning-text-color);
            --message-container-warning-background-color:var(--number-spinner-warning-background-color);
            --message-container-warning-border-left:var(--number-spinner-warning-border-left);
            --message-container-warning-box-shadow:var(--number-spinner-warning-box-shadow);      
        }

        /*SPINNER CONTAINER PROPERTIES*/
        .spinnerContainer {
            @apply(--layout-vertical);
             ----------------
        }

        .spinner {
            @apply(--layout-horizontal);
            align-items:center;
            border-bottom:1px solid #AAAAAA;
        }

        .spinner[active] {
            border-bottom:1px solid var(--number-spinner-color);
        }      

        /*INPUT PROPRETIES*/
        input {
            line-height:16px;
            font-size:14px;
            min-width: 160px;
            border:0px;
            text-align:right;
            user-select: none;
        }
        
        input[discrete] {
          pointer-events:none;
        }

        input:focus {
            outline: none;
            border:0px;
        }        

        /*ICON PROPERTIES*/
        iron-icon {
            height:8px;
            width:8px;
        }

        .spin {
            cursor:pointer;
        }

        /*DOWN BUTTON PROPERTIES*/
        .down {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 6px 4px 0 4px;
            border-color: #AAAAAA transparent transparent transparent;
            
            /*UNSELECT BUTTON*/
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none; 
        }

        .down:hover {
            border-color:red transparent transparent transparent;
        }

        /*UP BUTTON PROPERTIES*/
        .up {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 4px 6px 4px;
            border-color: transparent transparent #AAAAAA transparent;
            
            /*UNSELECT BUTTON*/
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none; 
        }

        .up:hover {
            border-color: transparent transparent red transparent;
        }
    </style>

<!--

  SPINNER IMPLEMENTATION (HTML)

--> 
    <div class="spinner" id="spinner">
        <div>[[label]]</div>
        <input id="input" is="iron-input" prevent-invalid-input allowed-pattern="[0-9.+-]" value="{{value::change}}" on-focus="_openDropdown" on-focusout="_closeDropdown" discrete$="[[discrete]]">
        <div style="width:8px"></div>
        <div class="spinnerContainer">
            <div><div class="spin up" on-tap="_up" on-mouseout="_closeDropdown"></div></div>
            <div style="height:2px;"></div>
            <div><div class="spin down" on-tap="_down" on-mouseout="_closeDropdown"></div></div>
        </div>
    </div>    
    <number-spinner-validator-plus value="{{value}}" allowed-numbers="[[values]]" min-error="[[min]]" max-error="[[max]]" step-warning="[[step]]" initial-value="[[initialValue]]" error-flag="{{errorFlag}}" warning-flag="{{warningFlag}}" message="{{message}}"></number-spinner-validator-plus>
    <message-container error-flag="[[errorFlag]]" warning-flag="[[warningFlag]]" message="[[message]]"></message-container>
  </template>

<!--

  SPINNER ENGINE (Polymer)

--> 
  <script>
    Polymer({

      is: 'number-spinner-plus',

      // READY FUNCTION: If is a discrete spinner, inizialize the index, if is a auto-sorting spinner, sort numbers*/
      ready:function() { 
        if(this.discrete){
          this.value=this.values[this.initialIndex];
          this.indexVisualized=this.initialIndex;
          if(this.autoSort) {
            values.sort();
          };
        };
        this.initialValue=this.value;
      },

      // OBSERVER: For future features
      _controlValueInserted:function(e) {
      },

      // DROPDOWN FUNCTIONS
       _openDropdown:function(e) {
        this.toggleAttribute("active",true,this.$.spinner);
      },
          
      _closeDropdown:function(e) {
        this.toggleAttribute("active",false,this.$.spinner);
      },

      // BUTTON UP FUNCTION
      _up:function() {
        // NOT DISCRETE: Free numbers
        if(!this.discrete) {
          // If it reaches the MAX with step then sets the value to MAX (do not exceed)
          this.value=((+this.value+this.step<this.max) ? +this.value+this.step : this.max);
        }
        // DISCRETE: Values fixed 
        else {
          if(this.indexVisualized<this.values.length-1){
            this.value=this.values[this.indexVisualized+1];
            this.indexVisualized=this.indexVisualized+1;
          }
          else{
            // CIRCULAR FEATURE
            if(this.circular)
            {
              this.value=this.values[0];
              this.indexVisualized=0;
            };
          };    
        };
        this.toggleAttribute("active",true,this.$.spinner);    
      },

      // BUTTON DOWN FUNCTION
      _down:function() {
        // NOT DISCRETE: Free numbers
        if(!this.discrete) {
          // If it reaches the MIN with step then sets the value to MIN (do not exceed)
          this.value=((+this.value-this.step>this.min) ? +this.value-this.step : this.min);
        }
        // DISCRETE: Values fixed
        else {
          if(this.indexVisualized>0){
            this.value=this.values[this.indexVisualized-1];
            this.indexVisualized=this.indexVisualized-1;
          }
          else{
            // CIRCULAR FEATURE
            if(this.circular)
            {
              this.value=this.values[this.values.length-1];
              this.indexVisualized=this.values.length-1;
            };
          };
        }; 
        this.toggleAttribute("active",true,this.$.spinner);
      },

      // NUMBER-SPINNER PROPERTIES
      properties: {

          // VALUE
          value:{
            value:null,
            notify:true,
            observer:"_controlValueInserted", // OBSERVER for future new features
          },

          values:{
            type:Array,
            value:null,
          },

          initialValue:{
            type:Number,
            value:null,
          },

          // LABEL
          label:{
            type:String,
            value:"Value",
          },

          // MESSAGE
          message:{
            type:String,
            value:null,
          },

          // CONTINUOS PROPERTIES
          min:{
            type:Number,
            value:null,
          },

          max:{
            type:Number,
            value:null,
          },

          min:{
            type:Number,
            value:null,
          },

          max:{
            type:Number,
            value:null,
          },

          step:{
            type:Number,
            value:1, 
          },

          digits:{
            type:Number,
            value:null,
          },

          // DISCRETE PROPERTIES
          indexVisualized:{
            type:Number,
            value:0,
            notify:true,
          },

          initialIndex:{
            type:Number,
            value:0,
          },

          circular:{
            type:Boolean,
            value:false,
          },

          autoSort:{
            type:Boolean,
            value:false,
          },

          // FLAGS
          allowed:{
            type:Boolean,
            value:true,
          },

          discrete:{
            type:Boolean,
            value:false,
          },

          errorFlag:{
            type:Boolean,
            value:false,
          },

          warningFlag:{
            type:Boolean,
            value:false,
          },
      },
    });
  </script>
</dom-module>